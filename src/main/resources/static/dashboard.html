<!DOCTYPE html>
<html>
    <head>
        <title>Dashboard</title>
        <link href="webjars/bootstrap/4.1.3/css/boostrap.min.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="webjars/jquery/3.3.1-1/jquery.min.js"></script>
        <script src="webjars/bootstrap/4.1.3/js/bootstrap.min.js"></script>

        <script>
            $(document).ready(function () {
                $("#download").click(function () {
                    $("#download").prop("disabled", true);
                    $.get("/downloadfile", function (data, status) {
                        if (status === "success") {
                            $("#btnSubmit").prop("disabled", false);
                            ("#downloadResult").text(data);
                        } else {
                            ("#downloadResult").text(status);
                            $("#download").prop("disabled", false);
                        }
                    });
                });


                $("#btnSubmit").click(function (event) {

                    //stop submit the form, we will post it manually.
                    event.preventDefault();

                    // Get form
                    var form = $('#fileUploadForm')[0];

                    // Create an FormData object 
                    var data = new FormData(form);

                    // If you want to add an extra field for the FormData
//                    data.append("CustomField", "This is some extra data, testing");

                    // disabled the submit button
                    $("#btnSubmit").prop("disabled", true);

                    $.ajax({
                        type: "POST",
                        enctype: 'multipart/form-data',
                        url: "/uploadFile",
                        data: data,
                        processData: false, //prevent jQuery from automatically transforming the data into a query string
                        contentType: false,
                        cache: false,
                        timeout: 600000,
                        success: function (data) {

                            $("#result").text(data);
                            console.log("SUCCESS : ", data);
                            $("#btnSubmit").prop("disabled", false);

                        },
                        error: function (e) {

                            $("#result").text(e.responseText);
                            console.log("ERROR : ", e);
                            $("#btnSubmit").prop("disabled", false);

                        }
                    });

                });
            });


        </script>
    </head>
    <body>
        <h1 class="text-center text-danger">Welcome!!</h1>
        <div class="text-center text-white">You're LoggedIn via google Oauth</div>

        <div class="col-12">
            <img src="images/download.png" style="width:50px;height: 30px" id="download">

            <pre>
    <span id="downloadResult"></span>
            </pre>
        </div>

        <form  id="fileUploadForm" enctype="multipart/form-data">
            <input name="file" id="filename" type="file" /><br><br>
            <button id="btnSubmit"  name="submit" >Upload</button>



        </form>
        <pre>
    <span id="result"></span>
        </pre>
    </body>
</html>

